module.exports=[93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},80998,e=>e.a(async(t,r)=>{try{var a=e.i(23862),n=t([a]);[a]=n.then?(await n)():n;let s=new a.Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:!1}});e.s(["default",0,s]),r()}catch(e){r(e)}},!1),34196,e=>e.a(async(t,r)=>{try{var a=e.i(89171),n=e.i(80998),s=t([n]);async function i(e){let t=e.headers.get("authorization"),r=process.env.INDEX_CREATION_TOKEN||"dev-only";if(t!==`Bearer ${r}`)return a.NextResponse.json({error:"Non autorisé. Utilisez un token d'autorisation en production."},{status:401});let s=[],i=[];try{for(let e of[{name:"idx_transactions_geom_gist",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_geom_gist ON transactions USING GIST (geom)",description:"Index spatial GIST pour ST_DWithin (CRITIQUE)"},{name:"idx_transactions_geom_geography_gist",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_geom_geography_gist ON transactions USING GIST (geom::geography)",description:"Index GIST sur géographie (pour distances en mètres)"},{name:"idx_transactions_code_postal",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_code_postal ON transactions (code_postal)",description:"Index sur code postal"},{name:"idx_transactions_nom_commune",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_nom_commune ON transactions (nom_commune)",description:"Index sur nom de commune"},{name:"idx_transactions_code_commune",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_code_commune ON transactions (code_postal, nom_commune)",description:"Index composite code postal + commune"},{name:"idx_transactions_type_local",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_type_local ON transactions (type_local) WHERE type_local IS NOT NULL",description:"Index partiel sur type de local (filtrage)"},{name:"idx_transactions_type_surface",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_type_surface ON transactions (type_local, surface_terrain)",description:"Index composite type + surface"},{name:"idx_transactions_date_mutation",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_date_mutation ON transactions (date_mutation DESC)",description:"Index sur date de mutation (tri)"},{name:"idx_transactions_id_date",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_id_date ON transactions (id_mutation, date_mutation DESC)",description:"Index composite id_mutation + date"},{name:"idx_transactions_valeur_fonciere",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_valeur_fonciere ON transactions (valeur_fonciere)",description:"Index sur valeur foncière (prix)"},{name:"idx_transactions_prix_date",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_prix_date ON transactions (valeur_fonciere DESC, date_mutation DESC)",description:"Index composite prix + date"},{name:"idx_transactions_surface_terrain",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_surface_terrain ON transactions (surface_terrain) WHERE type_local IS NULL AND surface_terrain > 0",description:"Index partiel sur surface terrain (pour terrains)"},{name:"idx_transactions_terrain_null",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_terrain_null ON transactions (type_local, surface_terrain)",description:"Index composite pour terrains"},{name:"idx_transactions_composite",sql:"CREATE INDEX IF NOT EXISTS idx_transactions_composite ON transactions (type_local, date_mutation DESC, valeur_fonciere)",description:"Index composite optimisé"}])try{let t=Date.now();await n.default.query(e.sql);let r=Date.now()-t;s.push({index:e.name,status:"created",duration:`${r}ms`,description:e.description}),console.log(`✅ Index cr\xe9\xe9 : ${e.name} (${r}ms)`)}catch(t){"42P07"===t.code||t.message.includes("already exists")||t.message.includes("duplicate")?s.push({index:e.name,status:"already_exists",message:"Index déjà existant",description:e.description}):(i.push({index:e.name,error:t.message,code:t.code,description:e.description}),console.error(`❌ Erreur pour l'index ${e.name}:`,t.message))}try{await n.default.query("ANALYZE transactions"),s.push({index:"ANALYZE",status:"completed",message:"Statistiques mises à jour"})}catch(e){i.push({index:"ANALYZE",error:e.message})}return a.NextResponse.json({success:!0,message:`Cr\xe9ation des index termin\xe9e. ${s.length} index trait\xe9s.`,results:{created:s.filter(e=>"created"===e.status).length,alreadyExists:s.filter(e=>"already_exists"===e.status).length,errors:i.length},details:{successful:s,errors:i.length>0?i:void 0},note:i.length>0?"Certains index n'ont pas pu être créés. Vérifiez les erreurs ci-dessus.":"Tous les index ont été créés avec succès. Les performances devraient être améliorées."})}catch(e){return console.error("[Create Indexes Error]",{message:e.message,stack:void 0}),a.NextResponse.json({error:"Erreur lors de la création des index",message:void 0,code:e.code},{status:500})}}[n]=s.then?(await s)():s,e.s(["GET",()=>i]),r()}catch(e){r(e)}},!1),98801,e=>e.a(async(t,r)=>{try{var a=e.i(47909),n=e.i(74017),s=e.i(96250),i=e.i(59756),o=e.i(61916),d=e.i(74677),c=e.i(69741),l=e.i(16795),u=e.i(87718),p=e.i(95169),x=e.i(47587),_=e.i(66012),m=e.i(70101),E=e.i(26937),h=e.i(10372),I=e.i(93695);e.i(52474);var g=e.i(220),N=e.i(34196),R=t([N]);[N]=R.then?(await R)():R;let v=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/create-indexes/route",pathname:"/api/create-indexes",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/create-indexes/route.js",nextConfigOutput:"",userland:N}),{workAsyncStorage:y,workUnitAsyncStorage:S,serverHooks:C}=v;function T(){return(0,s.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:S})}async function f(e,t,r){v.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/create-indexes/route";a=a.replace(/\/index$/,"")||"/";let s=await v.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:N,params:R,nextConfig:T,parsedUrl:f,isDraftMode:y,prerenderManifest:S,routerServerContext:C,isOnDemandRevalidate:A,revalidateOnlyGenerated:O,resolvedPathname:w,clientReferenceManifest:q,serverActionsManifest:D}=s,X=(0,c.normalizeAppPath)(a),b=!!(S.dynamicRoutes[X]||S.routes[w]),P=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,f,!1):t.end("This page could not be found"),null);if(b&&!y){let e=!!S.routes[w],t=S.dynamicRoutes[X];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await P();throw new I.NoFallbackError}}let j=null;!b||v.isDev||y||(j=w,j="/index"===j?"/":j);let U=!0===v.isDev||!b,k=b&&!U;D&&q&&(0,d.setManifestsSingleton)({page:a,clientReferenceManifest:q,serverActionsManifest:D});let F=e.method||"GET",H=(0,o.getTracer)(),$=H.getActiveScopeSpan(),L={params:R,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,n)=>v.onRequestError(e,t,a,n,C)},sharedContext:{buildId:N}},M=new l.NodeNextRequest(e),G=new l.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(M,(0,u.signalFromNodeResponse)(t));try{let s=async e=>v.handle(K,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${F} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${a}`)}),d=!!(0,i.getRequestMeta)(e,"minimalMode"),c=async i=>{var o,c;let l=async({previousCacheEntry:n})=>{try{if(!d&&A&&O&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(i);e.fetchMetrics=L.renderOpts.fetchMetrics;let o=L.renderOpts.pendingWaitUntil;o&&r.waitUntil&&(r.waitUntil(o),o=void 0);let c=L.renderOpts.collectedTags;if(!b)return await (0,_.sendResponse)(M,G,a,L.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[h.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,n=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await v.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,x.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:A})},!1,C),t}},u=await v.handleResponse({req:e,nextConfig:T,cacheKey:j,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:O,responseGenerator:l,waitUntil:r.waitUntil,isMinimalMode:d});if(!b)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});d||t.setHeader("x-nextjs-cache",A?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),y&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return d&&b||p.delete(h.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,E.getCacheControlHeader)(u.cacheControl)),await (0,_.sendResponse)(M,G,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};$?await c($):await H.withPropagatedContext(e.headers,()=>H.trace(p.BaseServerSpan.handleRequest,{spanName:`${F} ${a}`,kind:o.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},c))}catch(t){if(t instanceof I.NoFallbackError||await v.onRequestError(e,t,{routerKind:"App Router",routePath:X,routeType:"route",revalidateReason:(0,x.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:A})},!1,C),b)throw t;return await (0,_.sendResponse)(M,G,new Response(null,{status:500})),null}}e.s(["handler",()=>f,"patchFetch",()=>T,"routeModule",()=>v,"serverHooks",()=>C,"workAsyncStorage",()=>y,"workUnitAsyncStorage",()=>S]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__ab6ab816._.js.map